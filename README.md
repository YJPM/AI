# AI智能助手

一个为SillyTavern设计的智能AI助手扩展，提供智能选项生成和快捷操作功能。

## ✨ 功能特性

- 🤖 **智能选项生成**: 基于对话上下文自动生成4个行动建议
- ⚡ **多种推进节奏**: 正常、快速、跳跃三种时间推进模式
- 🎯 **手动/自动模式**: 支持手动选择和自动发送
- 🎨 **美观的UI**: 现代化的界面设计和流畅的动画效果
- 🔧 **灵活配置**: 丰富的设置选项和API支持
- 📱 **响应式设计**: 适配不同屏幕尺寸

## 🚀 快速开始

### 安装方法

1. **使用 URL 通过内置扩展管理器安装**：
   ```
   https://github.com/YJPM/AI
   ```

2. **手动安装**：
   - 下载项目文件
   - 将文件放入 `public/extensions/` 目录
   - 重启SillyTavern

### 配置设置

1. 打开SillyTavern设置页面
2. 找到"AI智能助手"扩展设置
3. 配置API密钥和模型参数
4. 选择适合的推进节奏和发送模式

## 📁 项目结构

```
AI/
├── index.js              # 主入口文件，事件处理
├── settings.js           # 设置管理和常量定义
├── optionsGenerator.js   # 选项生成核心逻辑
├── ui.js                 # UI组件和界面管理
├── logger.js             # 日志工具
├── manifest.json         # 扩展清单
├── manifest.json         # 扩展清单
└── README.md            # 项目文档
```

## 🔧 代码优化说明

### 最新优化内容

#### 1. **Logger.js 优化**
- ✅ 修复了`getSettings`引用问题
- ✅ 添加了缓存机制，避免频繁检查调试状态
- ✅ 改进了错误处理，避免影响主程序
- ✅ 统一了日志前缀为`[AI智能助手]`

#### 2. **Settings.js 优化**
- ✅ 添加了常量定义，提高代码可维护性
- ✅ 实现了设置管理类，支持缓存优化
- ✅ 改进了设置更新机制
- ✅ 添加了类型安全的设置访问

#### 3. **Index.js 优化**
- ✅ 重构为事件处理器类，提高代码组织性
- ✅ 消除了重复代码，统一事件处理逻辑
- ✅ 添加了完善的错误处理机制
- ✅ 改进了初始化流程

#### 4. **UI.js 优化**
- ✅ 简化了设置界面
- ✅ 移除了复杂的快捷面板
- ✅ 优化了加载状态显示
- ✅ 改进了选项按钮样式

#### 5. **OptionsGenerator.js 优化**
- ✅ 添加了工具函数类，提高代码复用性
- ✅ 实现了UI管理类，统一界面操作
- ✅ 改进了DOM操作的安全性
- ✅ 添加了防抖和节流功能

### 性能优化

- 🚀 **缓存机制**: 设置和DOM查询结果缓存
- 🚀 **防抖节流**: 避免频繁的API调用和DOM操作
- 🚀 **懒加载**: 按需加载模块和资源
- 🚀 **内存管理**: 及时清理不需要的DOM元素

### 代码质量

- 📝 **类型安全**: 添加了参数验证和错误处理
- 📝 **模块化**: 清晰的模块分离和职责划分
- 📝 **可维护性**: 统一的命名规范和代码风格
- 📝 **可扩展性**: 易于添加新功能和修改现有功能

## 🎯 使用指南

### 推进节奏模式

1. **正常模式**: 生成连续性的行动建议，适合日常对话
2. **快速模式**: 包含短期时间推进，适合任务和约会场景
3. **跳跃模式**: 显著时间跳跃，适合生活规划和长期发展

### 发送模式

1. **自动模式**: 点击选项后自动发送消息
2. **手动模式**: 支持多选选项，手动组合发送

### 快捷面板

- 可拖拽的快捷操作面板
- 支持推进节奏快速切换
- 一键重新生成选项功能
- 美观的loading动画效果

## 🔧 开发指南

### 添加新功能

1. 在相应的模块中添加功能代码
2. 更新设置文件中的配置项
3. 在UI中添加相应的控制元素
4. 更新文档和测试

### 调试模式

启用调试模式可以查看详细的日志信息：

```javascript
// 在设置中启用debug模式
settings.debug = true;
```

### API集成

支持多种API类型：

- **OpenAI兼容**: 支持所有OpenAI兼容的API
- **Google Gemini**: 原生支持Gemini API

## 📄 许可证

本项目采用MIT许可证，详见 [LICENSE](LICENSE) 文件。

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目！

## 📞 支持

如果您遇到问题或有建议，请：

1. 查看[常见问题](https://github.com/YJPM/AI/issues)
2. 提交新的Issue
3. 联系开发者

---

**版本**: 1.2.4  
**最后更新**: 2024年12月  
**兼容性**: SillyTavern 1.10+
